# ar.js

JavaScript библиотека для построения приложений с дополненной реальностью.
Основана на фреймворке [a-frame](https://aframe.io/).

## План доклада

1. Создать пустой a-frame, упомянуть про https.
2. Отрисовать box.
   Координаты отсчитываются от центра камеры экрана в момент загрузки страницы.
3. Рассказать про marker-based и location-based.
4. Отрисовать box внутри по стандарному hiro-маркеру.
4. Сделать маркер (barcode).
5. Pattern может определиться "вверх-ногами", для маркеры могут не определяться если сверху нет пространства.
6. Добавить свой маркер и отрисовать box внутри свого маркера.
7. Рассказать про требования/ограничения для маркеров и как их сгенерировать.
8. Добавить несколько маркеров и более сложную модель в каждый
9. Поворот модели.
10. Рассказать про несколько типов поддерживаемых моделей и почему gltf (recommended).
11. добавить поведение (marker focused event handler)

## Замечания

- It is also required to use remote urls for pattern resources, instead of relative urls

[barcode generator](https://au.gmented.com/app/marker/marker.php)
[qr generator](https://www.qrcode-monkey.com)

## Доклад

Привет. Я покажу как с помощью библиотеки AR.JS можно быстро и просто создать
web приложение с дополненной реальностью.

Давайте попробуем вместе создать упрощённую версию приложения с указателями
потоков нашей конференции, которое вы возможно уже видели и использовали.

<!-- Можно ли положить в гит? -->
Для этого скачаем шаблон проекта по ссылке https://itworks2020.vbogretsov.com/ar.zip.
Распакуем его и перейдём в распакованную папку, которую будем дальше называть "рабочей".

Так-как логика будет очень простой, нам не понадобится ставить nodejs.
Достаточно будет взять готовый сервер для статики. Например ran. Скачать его
можно по ссылке: https://github.com/m3ng9i/ran/releases. Положить его удобнее
всего будет просто в нашу рабочую папку.

Наше приложение спросит разрешения использовать камеру, поэтому соединение
должно быть обязательно защищённым, то есть мы будем использовать HTTPS. В
нашей рабочей папке уже лежит самоподписанный сертификат который можно
использовать для локального запуска.

<!-- ran -cert itworks2020.crt -key itworks2020.key -->
Давайте запустим сервер который будет отдавать наш index.html. Для этого в шашей
рабочей папке выполним команду

```
./ran -cert itworks2020.crt -key itworks2020.key
```

Для того чтобы открыть наше приложение на смартфоне нам нужно узнать IP-адрес
нашего ноутбука, для этого откроем терминал и выполним команду ifconfig если у
вас unix система или ipconfig если у вас windows.

Теперь, откроем на смартфоне в браузере наше приложение. Как видим оно
запросило разрешение открыть камеру и больше пока ничего не отображает.

Давайте сперва добавим простейший объект - box. Для этого раскоментируем строку
под комментарием Step 1, сохраним и перезагрузим страницу. Координаты для
отрисовки объекта box рассчитываются относительно положения камеры при загрузки
страницы. Если мы будем двигать наш смартфон то наш box может пропасть из
видимой области.

Мы можем добавить объект camera, который будет автоматически пересчитывать
координаты объектов внутри нашей сцены. Для этого раскоментируем строку с
комментарием 2.

Как видим теперь объект box постоянно в видимой области. Если у кого-то не
получилось, убедитесь, что вы сохранили index.html и перезагрузили страницу на
сматрфоне.

Пока мы использовали только библиотеку aframe, которая позволяет отображать 3-х
мерные объекты в браузере. AR.JS позволяет отображать объекты,
при условии что камера распознала маркер либо устройство находится в точке с
определёнными географическими координатами. Геопозиционирование в зданиии может
работать неточно, поэтому мы выбрали маркеры.

Одним из типов макеров, которые может распознавать AR.JS является баркод -
число закодированное в картинке. Для генерации можно воспользоваться
инструментами наподобие https://au.gmented.com/app/marker/marker.php. Баркод
был выбран потому что он распознаётся наиболее стабильно. Более сложные
картинки могут либо не всегда распознаваться либо распознаваться с искажениями,
например координаты могут иметь другую ориентацию.

В нашей рабочей папке уже есть сгенерированные баркоды для значений 0, 1, 2 и 3.
Давайте откроем в браузере страницу 00.html. Теперь закомментируем строку под
комментарием Step 1 и раскомментируем блок Step 3. Как видим при наведении на
маркер камера отображает на его месте box.

Box - это стандартный примитив библиоткеи aframe. Чтобы отобразить что-то более
интересное давайте закомментируем блок Step 3 и раскомментируем блоки Assets и
Step 4.

Теперь у нас отображается синияя стрелка под маркером. Обратите внимание на
значения в postition. Такие значения были указаны так как в выбранной модели
стрелка находится на некотором удалении от начала координат и при повороте она
перемещается.

Мы также можем отображать под маркером не один объект а несколько. Давайте
добавим текст над нашей стрелкой. Для этого закомментируем блок Step 4 и
раскомментируем Step 5.

На одной странице мы можем указать несколько различных маркеров. Давайте
раскоменнтируем блоки 6, 7, 8. И откроем в браузере страницы с маркерами
01.html, 02.html, 03.html.

При быстром переключении маркеров в браузере и статичном положении смартфона
иногда маркеры могут не распознаваться, тогда можно просто отвести камеру в
сторону и навести её на маркер опять.

Как вы можете наблюдать у нас меняется текст при наведении на различные маркеры,
но стрелка указывает всегда в том же направлении. Давайте попробуем менять
положение стрелки программно.
